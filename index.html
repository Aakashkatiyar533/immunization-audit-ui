<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Immunization Data Quality Review</title>
    <link
      rel="icon"
      type="image/svg+xml"
      href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Cg fill='none' stroke='%235b4da3' stroke-width='5' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='22' cy='26' r='8'/%3E%3Cpath d='M10 54c0-10 6-16 12-16s12 6 12 16'/%3E%3Cpath d='M40 18l14 6v14c0 10-7 16-14 19-7-3-14-9-14-19V24z'/%3E%3Cpath d='M37 34l5 5 10-12'/%3E%3C/g%3E%3C/svg%3E"
    />

    <!-- Styles -->
    <link rel="stylesheet" href="./styles.css" />

    <!-- Flatpickr (date picker) -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css"
    />

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Optional: Chart.js Data Labels -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
  </head>

  <body>
    <!-- =========================
       PAGE HEADER
  ========================== -->
    <header class="pageHeader">
      <div class="titleRow">
        <div class="titleMain">Immunization Data Quality Review</div>

        <button
          id="helpLink"
          class="helpLink"
          type="button"
          aria-haspopup="dialog"
          aria-controls="welcomeModal"
        >
          <span class="helpIcon" aria-hidden="true">
            <svg viewBox="0 0 24 24" class="helpIconSvg">
              <circle
                cx="12"
                cy="12"
                r="10"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              />
              <path
                d="M9.6 9a2.6 2.6 0 0 1 5 0c0 1.7-1.3 2.2-2.1 2.7-.6.3-.9.6-.9 1.3v.5"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
              />
              <circle cx="12" cy="17.2" r="1.2" fill="currentColor" />
            </svg>
          </span>
          How to use this dashboard
        </button>
      </div>

      <div class="titleSub">
        Supporting accurate immunization reporting and public health exchange
      </div>
    </header>

    <!-- =========================
       MAIN CONTAINER
  ========================== -->
    <div class="container">
      <!-- =========================
         LEFT PANE (Filters + Table)
    ========================== -->
      <div class="left">
        <!-- Controls Panel -->
        <div class="controlsPanel">
          <div
            style="display: flex; flex-wrap: wrap; gap: 12px; align-items: end"
          >
            <div>
              <label for="fromDate">From</label><br />
              <input id="fromDate" type="text" placeholder="YYYY-MM-DD" />
            </div>

            <div>
              <label for="toDate">To</label><br />
              <input id="toDate" type="text" placeholder="YYYY-MM-DD" />
            </div>

            <div>
              <label for="quickRange">Quick range</label><br />
              <select id="quickRange">
                <option value="">Custom</option>
                <option value="7">Last 7 days</option>
                <option value="30">Last 30 days</option>
              </select>
            </div>

            <div>
              <label for="filterMissing">Filter by missing</label><br />
              <select id="filterMissing">
                <option value="all">All records</option>
                <option value="vfc">Missing VFC</option>
                <option value="funding">Missing Funding</option>
                <option value="lot">Missing Lot</option>
                <option value="ndc">Missing NDC</option>
                <option value="contact">Missing Contact</option>
              </select>
            </div>
            <div>
              <label>
                <input type="checkbox" id="toggleCompletedRows" />
                Hide Complete Records
              </label>
              <label>
                <input type="checkbox" id="toggleDemographics" />
                Hide PHI
              </label>
            </div>
            <div>
              <label>&nbsp;</label><br />
              <button id="runBtn" class="btn">Run report</button>
            </div>

            <div>
              <label>&nbsp;</label><br />
              <button id="csvBtn" class="btn">Export CSV</button>
            </div>

            <label>&nbsp;</label><br />
            <span style="margin-left: auto" class="pill" id="countPill"
              >0 records</span
            >
          </div>
          <!-- Row highlight legend -->
          <div class="rowLegend">
            <span class="legendItem">
              <span class="legendSwatch high"></span>
              High priority (Funding Source missing)
            </span>

            <span class="legendItem">
              <span class="legendSwatch medium"></span>
              Medium priority (Inventory details missing)
            </span>

            <span class="legendItem">
              <span class="legendSwatch low"></span>
              Low priority (Contact details incomplete)
            </span>

            <span class="legendItem">
              <span class="legendSwatch reviewed"></span>
              Reviewed (Verified and corrected)
            </span>
          </div>

          <div style="font-size: 10px; color: #6b7280; margin-top: 4px">
            Rows are automatically highlighted to help prioritize documentation
            review.
          </div>
        </div>

        <!-- Table Wrapper -->
        <div class="tableWrapper">
          <!-- Loader overlay -->
          <div class="tableLoader" id="tableLoader" aria-hidden="true">
            <div class="loaderBox" role="status" aria-live="polite">
              <div class="spinner" aria-hidden="true"></div>
              <div id="loaderText">Running…</div>
            </div>
          </div>

          <!-- Data Table -->
          <table id="tbl">
            <thead>
              <tr>
                <th>Doc ID</th>
                <th>Patient ID</th>
                <th>Admin Date</th>
                <th>Vaccine</th>
                <th>VFC</th>
                <th>Funding</th>
                <th>Qty</th>
                <th>Units</th>
                <th>NDC</th>
                <th>Lot</th>
                <th>Exp Date</th>
                <th>Status</th>
                <th class="demographics">Age</th>
                <th class="demographics">Mobile</th>
                <th class="demographics">Email</th>
                <th>Reviewed</th>
              </tr>
            </thead>
            <tbody>
              <!-- rows injected by app.js -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- =========================
         RIGHT PANE (AI Report)
    ========================== -->
      <div class="right">
        <!-- AI Explainable Report -->
        <div id="aiReport"></div>

        <!-- Bar chart -->
        <canvas id="missingChart"></canvas>
      </div>
    </div>

    <!-- =========================
       RECORD GUIDANCE MODAL
  ========================== -->
    <div id="recordPanel" aria-hidden="true">
      <!-- Modal content injected by app.js -->
    </div>

    <!-- =========================
     HELP / HOW-TO MODAL (hidden by default)
========================== -->
    <div
      id="welcomeModal"
      class="welcomeOverlay"
      aria-hidden="true"
      style="display: none"
    >
      <div
        class="welcomeDialog rgModal"
        role="dialog"
        aria-modal="true"
        aria-labelledby="welcomeTitle"
      >
        <!-- Modal header -->
        <div class="welcomeHeader">
          <div>
            <h3 id="welcomeTitle">How to use this dashboard</h3>
            <p class="welcomeSub">
              Quickly identify and correct immunization documentation gaps.
            </p>
          </div>
          <!-- Close X -->
          <button
            type="button"
            class="welcomeCloseBtn"
            id="closeWelcomeBtn"
            aria-label="Close help"
          >
            <svg viewBox="0 0 24 24" aria-hidden="true">
              <line x1="6" y1="6" x2="18" y2="18" />
              <line x1="18" y1="6" x2="6" y2="18" />
            </svg>
          </button>
        </div>
        <div class="rgBody howToBody">
          <div class="howSection">
            <h4>What this dashboard helps you do</h4>
            <p class="howText">
              This dashboard highlights immunization records with documentation
              gaps that may delay registry acceptance, funding reconciliation,
              or audit readiness.
            </p>
          </div>

          <div class="howSection">
            <h4>How to review records</h4>
            <ul class="howList">
              <li>
                Filter records by date range (defaults to the last 7 days).
              </li>
              <li>
                Type <b>T</b> or <b>t</b> in a date field to auto-fill today’s
                date.
              </li>
              <li>
                Rows are automatically highlighted based on potential reporting
                impact.
              </li>
              <li>
                Click a <b>Document ID</b> to view record-level guidance and
                fixes.
              </li>
            </ul>
          </div>

          <div class="howSection">
            <h4>Reading the table at a glance</h4>
            <p class="howText">
              Row colors indicate the potential impact of missing or incomplete
              immunization data.
            </p>
            <!-- Mini table row mockup -->
            <div class="rowMockup">
              <div class="mockRow high">
                <span class="mockCell doc">IM-10234</span>
                <span class="mockCell vaccine">High priority</span>
                <span class="mockCell note"
                  >VFC Eligibility and Funding Source missing</span
                >
              </div>

              <div class="mockRow medium">
                <span class="mockCell doc">IM-10256</span>
                <span class="mockCell vaccine">Medium priority </span>
                <span class="mockCell note">Race and Ethnicity missing</span>
              </div>

              <div class="mockRow low">
                <span class="mockCell doc">IM-10278</span>
                <span class="mockCell vaccine">Low priority</span>
                <span class="mockCell note">Contact details incomplete</span>
              </div>

              <div class="mockRow reviewed">
                <span class="mockCell doc">IM-10301</span>
                <span class="mockCell vaccine">HepB</span>
                <span class="mockCell note">Reviewed</span>
              </div>
            </div>
          </div>

          <div class="howSection">
            <h4>Completing your review</h4>
            <ul class="howList">
              <li>Correct missing or incorrect fields directly in the EHR.</li>
              <li>
                Mark the record as <b>Reviewed</b> once corrections are
                complete.
              </li>
              <li>
                Reviewed records are visually de-emphasized to avoid duplicate
                follow-up.
              </li>
              <li>
                Export CSV to support team follow-up, audits, or registry
                coordination.
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- =========================
       TOAST CONTAINER
  ========================== -->
    <div id="toastContainer"></div>

    <!-- =========================
       SCRIPTS
  ========================== -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="./app.js"></script>
  </body>
</html>
